<div class="container mx-auto p-4">
    <div class="card bg-neutral-700/25 shadow-md rounded-lg p-4">
        <div class="card-content">
            <h1 class="shadow-md rounded-lg p-4 text-3xl font-semibold mb-4">
                List of all Employees
            </h1>
            <% if (info) { %>
            <div class="bg-green-100 text-green-800 p-4 rounded-lg mb-4">
                <%= info %>
            </div>
            <% } %>
            <div class="flex justify-center w-full">
                <div
                    class="shadow-md rounded-lg p-4 flex items-center relative content w-full max-w-2xl"
                >
                    <img
                        src="/icons/search.svg"
                        alt="search"
                        class="navIcon absolute w-6 h-6 text-white"
                    />
                    <input
                        id="search"
                        name="search"
                        type="text"
                        placeholder="Buscar empleado..."
                        class="w-full pl-10 p-3 bg-neutral-700/50 text-white rounded-md outline-none"
                    />
                </div>
            </div>
            <div class="p-4 rounded-md">
                <a href="/employee" class="btnPrimary content-left mr-4"
                    >Return</a
                >
                <a href="/employee/add" class="btnPrimary float-right"
                    >Add New Employee</a
                >
            </div>
            <div
                id="employeeTable"
                class="flex content justify-center p-4 rounded-md list space-y-4"
            ></div>
            <div class="flex justify-center gap-3 mt-6">
                <button id="prevPage" class="btnPrimary" disabled>
                    Anterior
                </button>
                <button id="nextPage" class="btnPrimary">Siguiente</button>
            </div>
        </div>
    </div>
</div>

<script>
    let currentPage = 1;
    let currentQuery = "";

    async function loadEmployees(page, query = "") {
        const url = query
            ? `/employee/search?page=${page}&query=${encodeURIComponent(query)}`
            : `/employee/search?page=${page}`;

        const res = await fetch(url);
        const data = await res.json();
        const employees = data.employees || [];

        let table = `<table class="w-full divide-y divide-neutral-200 text-center">
        <thead class="bg-neutral-800/50">
            <tr>
                <th class="px-6 py-3 text-xs font-medium uppercase tracking-wider">Full Name</th>
                <th class="px-6 py-3 text-xs font-medium uppercase tracking-wider">Department</th>
                <th class="px-6 py-3 text-xs font-medium uppercase tracking-wider">Role</th>
                <th class="px-6 py-3 text-xs font-medium uppercase tracking-wider">Action</th>
            </tr>
        </thead>
        <tbody class="bg-neutral-800 divide-y divide-neutral-200">`;

        if (employees.length === 0) {
            table += `<tr><td colspan="4" class="px-6 py-4 text-white text-center">No employees found</td></tr>`;
        } else {
            employees.forEach((emp) => {
                table += `<tr>
                <td class="px-6 py-4 text-white">${emp.birthName} ${
                    emp.surname
                }</td>
                <td class="px-6 py-4 text-white">${
                    emp.departmentName || "N/A"
                } - ${emp.enterpriseName}</td>
                <td class="px-6 py-4 text-white">${emp.roleName || "N/A"}</td>
                <td class="px-6 py-4 text-white">
                    <a href="/employee/check?id=${
                        emp.userID
                    }" class="btnPrimary ml-2">Check</a>
                </td>
            </tr>`;
            });

            // Solo hace scroll si hay resultados
            document
                .getElementById("employeeTable")
                .scrollIntoView({ behavior: "smooth" });
        }

        table += `</tbody></table>`;
        document.getElementById("employeeTable").innerHTML = table;

        // Control de paginaci√≥n
        document.getElementById("prevPage").disabled = page === 1;
        document.getElementById("nextPage").disabled = employees.length < 10;
    }

    document.getElementById("prevPage").addEventListener("click", () => {
        if (currentPage > 1) {
            currentPage--;
            loadEmployees(currentPage, currentQuery);
        }
    });

    document.getElementById("nextPage").addEventListener("click", () => {
        currentPage++;
        loadEmployees(currentPage, currentQuery);
    });

    document
        .getElementById("search")
        .addEventListener("input", async (event) => {
            currentQuery = event.target.value;
            currentPage = 1;
            loadEmployees(currentPage, currentQuery);
        });

    document.addEventListener("DOMContentLoaded", () => {
        loadEmployees(currentPage);
    });
</script>
