<div class="flex">
    <aside class="w-64"></aside>
    <div class="p-6">
        <div class="bg-neutral-700/25 shadow-lg rounded-lg">
            <div class="p-6">
                <h2 class="text-2xl font-semibold mb-4">
                    Descripción de la Solicitud de Vacaciones
                </h2>
                <p class="text-neutral-100">
                    A continuación, se presentan los detalles de la solicitud de vacaciones:
                </p>
                <div class="mt-4 space-y-2">
                    <p><strong class="text-neutral-300">ID Solicitud:</strong> <%= vacation.vacationID %></p>
                    <p><strong class="text-neutral-300">Motivo:</strong> <%= vacation.reason %></p>
                    <p><strong class="text-neutral-300">Fecha de Inicio:</strong> <%= vacation.startDate %></p>
                    <p><strong class="text-neutral-300">Fecha de Fin:</strong> <%= vacation.endDate %></p>
                    <p><strong class="text-neutral-300">Días Solicitados:</strong> <%= vacation.daysRequested %></p>
                    <p><strong class="text-neutral-300">Estado RH:</strong> 
                        <% if (vacation.hrStatus === 1) { %>
                            <span class="text-green-500">Aprobado</span>
                        <% } else if (vacation.hrStatus === 0) { %>
                            <span class="text-red-500">Denegado</span>
                        <% } else { %>
                            <span class="text-yellow-500">Pendiente</span>
                        <% } %>
                    </p>
                    <p><strong class="text-neutral-300">Estado Líder:</strong> 
                        <% if (vacation.leaderStatus === 1) { %>
                            <span class="text-green-500">Aprobado</span>
                        <% } else if (vacation.leaderStatus === 0) { %>
                            <span class="text-red-500">Denegado</span>
                        <% } else { %>
                            <span class="text-yellow-500">Pendiente</span>
                        <% } %>
                    </p>
                    <p><strong class="text-neutral-300">Comentarios:</strong> <%= vacation.comments || 'Sin comentarios' %></p>
                </div>
            </div>
        </div>
        <div class="flex space-x-4 justify-center mt-6">
            <a href="/vacation/check/modify/<%= vacation.vacationID %>" class="btnPrimary">
                Modificar Solicitud
            </a>
            <a href="/vacation/check/<%= vacation.vacationID %>" 
                class="btnPrimary" 
                id="btnEliminar" 
                data-id="<%= vacation.vacationID %>">
                Eliminar
             </a>
        </div>
    </div>
</div>
<meta name="csrf-token" content="<%= csrfToken %>">
<script src="/javascript/sweetalert2.all.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const btnEliminar = document.getElementById("btnEliminar");

    if (!btnEliminar) return;

    btnEliminar.addEventListener("click", async function (event) {
      event.preventDefault();

      const vacationID = btnEliminar.getAttribute("data-id");

      const result = await Swal.fire({
        title: '¿Estás seguro?',
        text: "¡Esta acción no se puede deshacer!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Sí, eliminar',
        cancelButtonText: 'Cancelar'
      });

      if (result.isConfirmed) {
        try {
            const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');

            const response = await fetch(`/vacation/check/delete/${vacationID}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'CSRF-Token': csrfToken // Header que espera `csurf`
            },
            body: JSON.stringify({ id: vacationID })
            });

          if (response.ok) {
            Swal.fire('Eliminado', 'La solicitud ha sido eliminada.', 'success')
              .then(() => {
                // Redirige a la lista u otra página
                window.location.href = '/vacation';
              });
          } else {
            throw new Error('Error en la eliminación');
          }
        } catch (err) {
          Swal.fire('Error', 'No se pudo eliminar la solicitud.', 'error');
        }
      }
    });
  });
</script>
