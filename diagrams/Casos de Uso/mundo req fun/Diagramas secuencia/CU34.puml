@startuml
actor Navegador
boundary "oneToOne.routes" as Routes
boundary "error.routes" as Error
boundary "oneToOneForm.ejs" as Ejs
control "oneToOne.controller" as Controller
entity "answer" as Answer
entity "measure" as Measure
entity "oneToOne.model" as Model
database "mysql" as MySQL

autonumber

activate Navegador
Navegador -> Routes  : GET /oneToOne/:id/fill
deactivate Navegador

activate Routes 
Routes  -> Controller : getFill(request, response)
deactivate Routes 

activate Controller

Controller ->> Model : fetchSessionData(request.params.id)
activate Model
Model ->> MySQL : execute(...)
activate MySQL
MySQL -->> Model : rows
deactivate MySQL
Model -->> Controller : rows

deactivate Model

Controller -> Ejs : response.render('oneToOneFill.ejs', {...})
deactivate Controller

activate Ejs
Ejs -> Navegador : HTML
deactivate Ejs

activate Navegador
Navegador -> Routes  : POST /oneToOne/:id/fill
deactivate Navegador

activate Routes 
Routes  -> Controller : postFill(request, response)
deactivate Routes 

activate Controller

Controller ->> Model : fetchSessionData(request.params.id)
activate Model
Model ->> MySQL : execute(...)
activate MySQL
MySQL -->> Model : rows
deactivate MySQL
Model -->> Controller : rows
deactivate Model

loop answers.foreach
    Controller -> Answer : new Answer(...)
    activate Answer
    Controller ->> Answer : save()
    Answer ->> MySQL : execute(...)
    activate MySQL
    MySQL -->> Answer : Query OK
    deactivate MySQL
    Answer -->> Controller : promesa
    deactivate Answer
end

loop measures.foreach
    Controller -> Measure : new Measure(...)
    activate Measure
    Controller ->> Measure : save()
    Measure ->> MySQL : execute(...)
    activate MySQL
    MySQL -->> Measure : Query OK
    deactivate MySQL
    Measure -->> Controller : promesa
    deactivate Measure
end

Controller -> Routes  : response.redirect(`/oneToOne/${sessionID}`)
deactivate Controller

@enduml