@startuml

actor navegador
boundary routes
boundary "Vista listaReportes.ejs" as list
control controller
entity Report
database mysql


autonumber
activate navegador
navegador -> routes: GET /reportes/rotacion
deactivate navegador
activate routes
routes -> controller: get_reports(req, res)
deactivate routes

activate controller
controller ->> Report: getInfoActivos(start, end)
activate Report
Report ->> mysql: SELECT u.*, d.title FROM user u, userDepartment ud, department d \nWHERE u.userID = ud.userIDFK AND ud.departmentIDFK = d.departmentID \nAND u.userID IN(SELECT userID FROM user u, workStatus w WHERE \nu.userID = w.userStatusIDFK AND u.workStatus = 1 \nAND w.startDate BETWEEN ? AND ?) ORDER BY d.title
mysql -->> Report: activeUsers
deactivate mysql
Report -->> controller: Promesa
deactivate Report

controller ->> Report: getInfoInactivos(start, end)
activate Report
Report ->> mysql: SELECT u.*, d.title FROM user u, userDepartment ud, department d \nWHERE u.userID = ud.userIDFK AND ud.departmentIDFK = d.departmentID \nAND u.userID IN(SELECT userID FROM user u, workStatus w WHERE \nu.userID = w.userStatusIDFK AND u.workStatus = 0 \nAND w.endDate BETWEEN ? AND ?) ORDER BY d.title
activate mysql
mysql -->> Report: inactiveUsers
deactivate mysql
Report -->> controller: Promesa
deactivate Report


controller -> list: res.render('rotacion.ejs', data)
deactivate controller
activate list
list --> navegador: HTML
deactivate list
activate navegador

@enduml
